<!--<div class="cart-container">-->
<!--    <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>-->

<!--    <div id="cart-list"></div>-->

<!--    <button class="btn-cart btn-order" id="btn-order">ƒê·∫∑t h√†ng</button>-->
<!--    <button class="btn-cart btn-back" onclick="window.location.href='layouts/shop'">‚Üê Quay l·∫°i shop</button>-->

<!--    <div id="order-message">S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t, ƒëang ch·ªù x√°c nh·∫≠n!</div>-->
<!--</div>-->

<!--<script>-->
<!--    const cartList = document.getElementById("cart-list");-->
<!--    const btnOrder = document.getElementById("btn-order");-->
<!--    const orderMessage = document.getElementById("order-message");-->

<!--    let cart = JSON.parse(localStorage.getItem('cart')) || [];-->

<!--    function saveCart() {-->
<!--        localStorage.setItem('cart', JSON.stringify(cart));-->
<!--    }-->

<!--    function attachEvents() {-->
<!--        document.querySelectorAll('.btn-delete').forEach(btn => {-->
<!--            btn.addEventListener('click', () => {-->
<!--                const index = btn.dataset.index;-->
<!--                cart.splice(index, 1);-->
<!--                saveCart();-->
<!--                renderCart();-->
<!--            });-->
<!--        });-->

<!--        document.querySelectorAll('.increase').forEach(btn => {-->
<!--            btn.addEventListener('click', () => {-->
<!--                const index = btn.dataset.index;-->
<!--                cart[index].qty += 1;-->
<!--                saveCart();-->
<!--                renderCart();-->
<!--            });-->
<!--        });-->

<!--        document.querySelectorAll('.decrease').forEach(btn => {-->
<!--            btn.addEventListener('click', () => {-->
<!--                const index = btn.dataset.index;-->
<!--                if (cart[index].qty > 1) {-->
<!--                    cart[index].qty -= 1;-->
<!--                    saveCart();-->
<!--                    renderCart();-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function renderCart() {-->
<!--        if (cart.length === 0) {-->
<!--            cartList.innerHTML = "<p>Gi·ªè h√†ng ƒëang tr·ªëng.</p>";-->
<!--            return;-->
<!--        }-->

<!--        cartList.innerHTML = "";-->
<!--        let totalAll = 0;-->

<!--        cart.forEach((item, index) => {-->
<!--            const totalPrice = item.price * item.qty;-->
<!--            totalAll += totalPrice;-->

<!--            cartList.innerHTML += `-->
<!--                <div class="cart-item">-->
<!--                    <img src="${item.img}" alt="${item.name}">-->
<!--                    <div class="cart-info">-->
<!--                        <h4>${item.name}</h4>-->
<!--                        <p class="cart-price">Gi√°: ${Number(item.price).toLocaleString()}‚Ç´</p>-->

<!--                        <div class="quantity-control">-->
<!--                            <button class="decrease" data-index="${index}">-</button>-->
<!--                            <span>${item.qty}</span>-->
<!--                            <button class="increase" data-index="${index}">+</button>-->
<!--                        </div>-->

<!--                        <p class="cart-price">T·ªïng: ${totalPrice.toLocaleString()}‚Ç´</p>-->
<!--                    </div>-->

<!--                    <button class="btn-cart btn-delete" data-index="${index}">X√≥a</button>-->
<!--                </div>-->
<!--            `;-->
<!--        });-->

<!--        cartList.innerHTML += `-->
<!--            <h3 style="text-align:right;margin-top:20px;font-family:'Playfair Display';">-->
<!--                T·ªïng ƒë∆°n h√†ng: ${totalAll.toLocaleString()}‚Ç´-->
<!--            </h3>-->
<!--        `;-->

<!--        attachEvents();-->
<!--    }-->

<!--    renderCart();-->

<!--    btnOrder.addEventListener('click', () => {-->
<!--        if (cart.length === 0) {-->
<!--            alert("Gi·ªè h√†ng ƒëang tr·ªëng!");-->
<!--            return;-->
<!--        }-->

<!--        orderMessage.style.display = 'block';-->
<!--        setTimeout(() => { orderMessage.style.display = 'none'; }, 2500);-->

<!--        localStorage.removeItem('cart');-->
<!--        cart = [];-->
<!--        renderCart();-->
<!--    });-->
<!--</script>-->
<div class="cart-page-header">
    <h2 class="main-cart-title">Gi·ªè h√†ng c·ªßa b·∫°n</h2>
</div>

<div class="cart-container-centered">
    <div class="cart-wrapper">
        <div class="cart-left">
            <div id="cart-list">
            </div>
        </div>

        <div class="cart-right">
            <div class="order-summary-card">
                <h2 class="summary-title">ƒê∆°n H√†ng C·ªßa B·∫°n</h2>
                <div class="summary-details">
                    <div class="summary-row">
                        <span>S·ªë l∆∞·ª£ng s·∫£n ph·∫©m:</span>
                        <span id="total-qty" class="val-bold">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Th√†nh Ti·ªÅn:</span>
                        <span id="sub-total" class="val-bold">0‚Ç´</span>
                    </div>
                    <div class="summary-row">
                        <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                        <span class="free-ship-text">Mi·ªÖn ph√≠</span>
                    </div>
                    <hr class="divider">
                    <div class="summary-row total-row">
                        <span>T·ªïng c·ªông:</span>
                        <span id="total-all-final" class="final-price">0‚Ç´</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-action btn-checkout" id="btn-order">Ti·∫øn H√†nh Thanh To√°n</button>
                    <button class="btn-action btn-clear" id="btn-clear-all">X√≥a To√†n B·ªô Gi·ªè H√†ng</button>
                    <button class="btn-action btn-back-shop" onclick="window.location.href='/shop'">Ti·∫øp T·ª•c Mua S·∫Øm</button>
                </div>
                <div id="order-message">üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ c·ª≠a h√†ng...</div>
            </div>
        </div>
    </div>
</div>

<script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function renderCart() {
        const cartList = document.getElementById("cart-list");
        if (cart.length === 0) {
            cartList.innerHTML = `
                <div style="text-align:center; padding:60px; background:white; border-radius:20px; box-shadow:var(--shadow);">
                    <img src="https://cdn-icons-png.flaticon.com/512/11329/11329060.png" width="80" style="opacity:0.2;">
                    <h3 style="color:#888; margin-top:20px;">Gi·ªè h√†ng c·ªßa b·∫°n hi·ªán ƒëang tr·ªëng</h3>
                    <button class="btn-action btn-back-shop" style="width:200px; margin-top:20px;" onclick="window.location.href='/shop'">Mua s·∫Øm ngay</button>
                </div>`;
            updateSummary(0, 0);
            return;
        }

        let html = ""; let total = 0; let qty = 0;
        cart.forEach((item, i) => {
            const sub = item.price * item.qty;
            total += sub; qty += item.qty;

            // X√°c ƒë·ªãnh lo·∫°i (m·∫∑c ƒë·ªãnh l√† B√≥ hoa n·∫øu kh√¥ng c√≥ category)
            const typeLabel = item.category === 'giohoa' ? 'Gi·ªè hoa' : 'B√≥ hoa';

            html += `
            <div class="cart-card">
                <button class="btn-del-item" onclick="removeItem(${i})">‚úï</button>
                <img src="${item.img}" alt="${item.name}">
                <div class="card-info-box">
                    <span class="category-badge">${typeLabel}</span>
                    <h4 class="prod-name">${item.name}</h4>

                    <div class="qty-control-wrapper">
                        <div class="qty-box">
                            <button class="qty-btn" onclick="changeQty(${i},-1)">-</button>
                            <span style="font-weight:bold; width:25px; text-align:center;">${item.qty}</span>
                            <button class="qty-btn" onclick="changeQty(${i},1)">+</button>
                        </div>
                        <div class="price-details">
                            <span class="unit-price">ƒê∆°n gi√°: ${Number(item.price).toLocaleString()}‚Ç´</span>
                            <span class="subtotal-item">${sub.toLocaleString()}‚Ç´</span>
                        </div>
                    </div>
                </div>
            </div>`;
        });
        cartList.innerHTML = html;
        updateSummary(total, qty);
    }

    function updateSummary(t, q) {
        document.getElementById('total-qty').innerText = q;
        document.getElementById('sub-total').innerText = t.toLocaleString() + '‚Ç´';
        document.getElementById('total-all-final').innerText = t.toLocaleString() + '‚Ç´';
    }

    window.changeQty = (i, d) => {
        if(cart[i].qty + d > 0) { cart[i].qty += d; save(); }
    }

    window.removeItem = (i) => {
        if(confirm("B·∫°n mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")) { cart.splice(i,1); save(); }
    }

    function save() {
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
    }

    document.getElementById('btn-clear-all').onclick = () => {
        if(cart.length > 0 && confirm("X√≥a to√†n b·ªô gi·ªè h√†ng?")) { cart = []; save(); }
    }

    document.getElementById('btn-order').onclick = () => {
        // 1. Ki·ªÉm tra gi·ªè h√†ng
        if (cart.length === 0) {
            return alert("Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!");
        }

        // 2. Hi·ªáu ·ª©ng n√∫t b·∫•m (T√πy ch·ªçn cho ƒë·∫πp)
        const btn = document.getElementById('btn-order');
        btn.innerHTML = "‚åõ ƒêang chuy·ªÉn sang thanh to√°n...";
        btn.style.opacity = "0.7";

        // 3. CHUY·ªÇN H∆Ø·ªöNG SANG TRANG BILL
        // L∆∞u √Ω: KH√îNG d√πng localStorage.removeItem('cart') ·ªü ƒë√¢y.
        setTimeout(() => {
            window.location.href = '/thanhtoan';
        }, 1000); // Ch·ªù 1 gi√¢y ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng m∆∞·ª£t m√†
    }

    renderCart();
</script>